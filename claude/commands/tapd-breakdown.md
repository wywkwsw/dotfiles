---
description: "TAPD 需求单拆解：前端任务分解 → 自动调用 prom-plan"
argument-hint: "<TAPD 需求内容或链接>"
---

你现在处于 **TAPD 需求拆解模式**。

## 上下文收集策略 ⚡

在拆解需求前，必须先理解项目结构和现有实现。

### 工具优先级

| 优先级 | 工具 | 用途 | 降级条件 |
|--------|------|------|----------|
| 1️⃣ | `ace-tool (mcp__ace-tool__search_context)` | 查找相关组件、理解代码关系、定位模块 | 连接失败/超时 |
| 2️⃣ | `rg` / `grep` | 精确模式匹配、关键字搜索 | ace-tool 不可用时 |
| 3️⃣ | `ReadFile` | 直接读取已知文件 | 作为补充或精确定位 |

### 降级策略

如果 ace-tool 不可用：

1. **记录状态**：在输出中标注 `⚠️ ace-tool 不可用，使用兜底方案`
2. **替代方案**：
   - `rg "ComponentName" --type vue` 搜索组件
   - `rg "api" --glob "*.ts"` 查找 API 调用
   - 读取 `src/router` / `src/views` 理解页面结构
3. **增加风险标注**：对依赖关系不确定的任务，在拆解中标注风险

## 概述

此命令将 TAPD 需求单拆解为前端任务，然后自动调用 `prom-plan` 生成计划文件。

**流程：**
```
TAPD 需求 → 前端任务拆解 → prom-plan → MD + CSV 生成 → 审批门
```

---

## 第一步：解析 TAPD 需求

从用户提供的 TAPD 需求中提取：

| 字段 | 说明 |
|------|------|
| 需求标题 | 一句话概括 |
| 需求描述 | 详细说明 |
| 验收标准 | 用户/产品期望 |
| 优先级 | P0/P1/P2 |
| 关联模块 | 涉及的页面/组件 |
| 附件/原型 | 设计稿、流程图等 |

**输出格式：**
```markdown
## 📋 TAPD 需求解析

**标题**：<需求标题>
**优先级**：<P0|P1|P2>
**关联模块**：<页面/组件列表>

### 需求描述
<原始需求描述>

### 验收标准
<产品验收标准>

### 附件/参考
- <原型链接>
- <设计稿>
```

---

## 第二步：前端任务拆解

### 2.1 拆解维度

按以下维度拆解前端任务：

| 维度 | 示例任务 |
|------|----------|
| **UI 组件** | 新增/修改组件、样式实现 |
| **页面布局** | 页面结构、响应式适配 |
| **交互逻辑** | 点击、滚动、拖拽等交互 |
| **状态管理** | store 变更、数据流 |
| **API 对接** | 接口调用、数据处理 |
| **表单处理** | 表单验证、提交逻辑 |
| **错误处理** | 异常 UI、兜底状态 |
| **性能优化** | 懒加载、虚拟化等 |

### 2.2 拆解输出格式

```markdown
## 🔧 前端任务拆解

| ID | 任务 | 验收条件 | 优先级 | 依赖 |
|----|------|----------|--------|------|
| FE-001 | <任务描述> | <验收条件> | P1 | - |
| FE-002 | <任务描述> | <验收条件> | P1 | FE-001 |
| FE-003 | <任务描述> | <验收条件> | P2 | FE-001 |
| ... | ... | ... | ... | ... |
```

### 2.3 任务粒度建议

- 每个任务 **0.5-2 天** 可完成
- 单个组件/页面拆为 1 个任务
- 复杂交互单独拆分
- API 对接按接口数量拆分

---

## 第三步：依赖关系分析

```markdown
## 📊 任务依赖

### 执行顺序
1. FE-001 (基础组件) 
2. FE-002, FE-003 (可并行)
3. FE-004 (依赖 FE-002)
...

### 关键路径
<最长依赖链路>

### 阻塞风险
- <设计稿未确认>
- <API 未提供>
- ...
```

---

## 第四步：技术方案摘要

```markdown
## 💡 技术方案

### 涉及页面
- <页面 1>
- <页面 2>

### 新增组件
- <组件 1>：<用途>
- <组件 2>：<用途>

### 状态变更
- <store/state 变更>

### API 依赖
- <接口 1>：<用途>
- <接口 2>：<用途>

### 风险点
- <技术风险>
- <时间风险>
```

---

## 第五步：自动调用 prom-plan

拆解完成后，自动执行 `prom-plan` 命令：

1. 将前端任务作为 prom-plan 的输入
2. 生成 `plan/<date>-<tapd-id>.md`
3. 生成 `issues/<timestamp>-<tapd-id>.csv`
4. 更新 `issues/issues.csv`
5. 请求审批

**CSV 字段 `area` 统一填写 `frontend`**

**合并输出：**
```
## ✅ TAPD 拆解完成

### 拆解统计
- 前端任务：N 个
- 优先级分布：P0=X, P1=Y, P2=Z

### 生成的文件
- 计划 MD：`plan/<文件名>.md`
- Issues CSV（快照）：`issues/<文件名>.csv`
- Issues CSV（汇总）：`issues/issues.csv`

### 下一步
**是否批准进入 D 阶段？**
- [ ] 是，开始实现
- [ ] 否，需要修改（请说明）
```

---

## 执行检查清单

1. [ ] 解析 TAPD 需求内容
2. [ ] 拆解前端任务（带验收条件）
3. [ ] 分析任务依赖关系
4. [ ] 生成技术方案摘要
5. [ ] 调用 prom-plan 生成 MD 和 CSV
6. [ ] 输出摘要并请求审批

---

## 特殊场景处理

### 需求信息不足
如果 TAPD 内容不完整：
- 列出缺失信息（原型、设计稿、API 文档等）
- 请求用户补充
- 不进行拆解直到信息完整

### 设计稿未确认
- 标注为阻塞风险
- 先拆解可确定的任务
- 待确认部分标注 `TBD`

### 依赖后端接口
- 在任务中注明 API 依赖
- 标注预期接口格式（如有）
- 可先用 Mock 数据开发

**⚠️ 未经明确批准，不得进入 D 阶段。**
